# Build a docker image with all dependencies for cuda-enabled devices running the command below from the repo root folder.
# Dependency: Docker, Nvidia-Docker, Nvidia cuda-enabled GPU. If you do not have Nvidia GPU you should use the Dockerfile_NoCUDA for building the image on Linux/Windows.
docker build . -t vtprl_image -f Docker/Dockerfile

# The Docker image above is built for Python3.7. To build a docker image for Python3.8, run the command below.
docker build . -t vtprl_image -f Docker/Dockerfile_Python38

# To build the most recent docker image for Python3.10 with CUDA 12.8 and Ubuntu 22.04 base image, run the command below.
docker build . -t vtprl_image -f Docker/Dockerfile_Python310
docker build . -t vtprl_image -f Docker/Dockerfile_Python310 --no-cache

# Build a docker image with all dependencies for non-cuda-enabled devices running the command below from the repo root folder. 
# Dependencies: Docker. Only difference from Dockerfile is the root image it starts from for system configurations that do not support GPU acceleration from inside Docker.
# This image is only for Python 3.7. You can replicate the same changes for other Python versions.
docker build . -t vtprl_image -f Docker/Dockerfile_NoCUDA

# These commands are useful to run before starting the container in case you want to start the simulator from a shell inside the container
# (not recommended for Windows, works on linux) - it allows local connections to your X server.
export DISPLAY=":1"
xhost + local:

# After building create a container with the built image running the command below from the repo root folder.
# Same for NoCUDA, but remove the --gpus parameter as it is not supported on non-cuda-enabled devices. [repo_name] is a name placeholder; for instance you can use vtprl.
docker run --rm -it \
           --name vtprl_container \
           --gpus all \
           -e DISPLAY \
           -v $(pwd):/home/vtprl:rw \
           -v $(pwd)/external/stable-baselines3:/home/repos/stable-baselines3:ro \
           --privileged \
           --net="host" \
           --env="NVIDIA_DRIVER_CAPABILITIES=all" \
           vtprl_image:latest \
           bash

# If you are running the Docker container on WSL under Windows 11 and would like to enable the graphical viewers and monitors,
# you need to create a container with command below. This time several options have been added to enable container's access to Gtk and connected screens.
# In this way, graphical apps can be started within the container. 
docker run --rm -it \
           --name vtprl_container \
           --gpus all \
           -v /tmp/.X11-unix:/tmp/.X11-unix \
           -v /mnt/wslg:/mnt/wslg \
           -e DISPLAY \
           -e WAYLAND_DISPLAY \
           -e XDG_RUNTIME_DIR \
           -e PULSE_SERVER \
           -v $(pwd):/home/[repo_name]:rw \
           -v $(pwd)/external/stable-baselines3:/home/repos/stable-baselines3:ro \
           --privileged \
           --net="host" \
           vtprl_image:latest \
           bash

# By excluding the --rm option from the above commands, the container can persist even after closing.
# This is useful for continous development. To run the existing container for the next runs, the command below can be used.
docker start -ai vtprl_container

# On local machines you can start the simulator outside of docker as well, cd to the repository root folder inside the docker container
# and run python3 agant/main.py to connect to the simulator and start training.

# If there are errors see "Troubleshooting" section.
